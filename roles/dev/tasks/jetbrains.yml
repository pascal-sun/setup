---
################################################################################
# - name: Install PyCharm
#   community.general.snap:
#     classic: true
#     name: pycharm-professional
#   become: true
#   tags: installed_with_snap

- name: Install apt packages
  become: true
  ansible.builtin.apt:
    name: libfuse2
    state: present
    update_cache: true


- name: Check if JetBrains Toolbox App is already installed
  ansible.builtin.stat:
    path: "{{ ansible_env.HOME }}/.local/share/\
    JetBrains/Toolbox/bin/jetbrains-toolbox"
  register: toolbox

- name: Download and unarchive JetBrains Toolbox App
  ansible.builtin.unarchive:
    src: "https://www.jetbrains.com/\
    toolbox-app/download/download-thanks.html?platform=linux"
    dest: /tmp/jetbrains-toolbox
    remote_src: yes
    mode: u=rwx,g=rx,o=rx
  when: not toolbox.stat.exists

- name: Install JetBrains Toolbox App
  ansible.builtin.shell: /tmp/jetbrains-toolbox/jetbrains-toolbox
  args:
    executable: /usr/bin/fish
  register: result
  changed_when: true
  failed_when: result.rc != 0
  when: not toolbox.stat.exists
